#!/usr/bin/env ruby

# The ruby driver does not use protocol buffers any more, but
# it uses the constants from the proto file.
#
# This script strips protobuf-related declarations and
# wraps the file in the RethinkDB module

puts "# DO NOT EDIT"
puts "# Autogenerated by strip-pbfile"
puts "module RethinkDB"
ARGF.each do |line|
  next if line =~ /^ *class.*end$/ # Remove empty classes

  puts "  #{$1}" if line =~ /
  ^(\ * class\ \w+            # Keep class declarations (but remove parent classes)
   |\ * module\ \w+$          # Keep module declarations
   |\ * [A-Z]\w+\ =\ [0-9]+$  # Keep numerical constants declarations
   |\ * end$                  # Keep end keywords
   )/x
end
puts "end"
