#!/usr/bin/env perl

# The ruby driver does not use protocol buffers any more, but
# it uses the constants from the proto file.
#
# This script strips protobuf-related declarations and
# wraps the file in the RethinkDB module

print "# DO NOT EDIT\n";
print "# Autogenerated by strip-pbfile\n";
print "module RethinkDB\n";
while(<>){
  next if /^ *class.*end$/;   # Remove empty classes

  print "  $1\n" if /
  ^(\ * class\ \w+            # Keep class declarations (but remove parent classes)
   |\ * module\ \w+$          # Keep module declarations
   |\ * [A-Z]\w+\ =\ [0-9]+$  # Keep numerical constants declarations
   |\ * end$                  # Keep end keywords
   )/x
}
print "end\n"
